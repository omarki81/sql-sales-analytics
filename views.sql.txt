CREATE VIEW vw_sales AS
SELECT
    o.order_id,
    o.order_date,
    c.customer_id,
    c.first_name,
    c.last_name,
    c.city,
    c.country,
    p.product_id,
    p.product_name,
    p.category,
    oi.quantity,
    oi.unit_price,
    (oi.quantity * oi.unit_price) AS revenue,
    (oi.quantity * (oi.unit_price - p.cost)) AS profit
FROM orders o
JOIN customers c ON o.customer_id = c.customer_id
JOIN order_items oi ON o.order_id = oi.order_id
JOIN products p ON oi.product_id = p.product_id
WHERE o.order_status = 'Completed';

CREATE VIEW vw_monthly_revenue AS
SELECT
    DATE_TRUNC('month', order_date) AS month,
    SUM(revenue) AS total_revenue,
    SUM(profit) AS total_profit
FROM vw_sales
GROUP BY month
ORDER BY month;

CREATE VIEW vw_customer_performance AS
SELECT
    customer_id,
    first_name,
    last_name,
    city,
    country,
    COUNT(DISTINCT order_id) AS total_orders,
    SUM(revenue) AS total_revenue,
    SUM(profit) AS total_profit
FROM vw_sales
GROUP BY customer_id, first_name, last_name, city, country;

CREATE VIEW vw_product_performance AS
SELECT
    product_id,
    product_name,
    category,
    SUM(quantity) AS units_sold,
    SUM(revenue) AS total_revenue,
    SUM(profit) AS total_profit
FROM vw_sales
GROUP BY product_id, product_name, category;
